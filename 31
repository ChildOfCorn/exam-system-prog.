#include <stdio.h>

int main() {
    STARTUPINFO si;
    PROCESS_INFORMATION pi;

    ZeroMemory(&si, sizeof(si));
    si.cb = sizeof(si);
    ZeroMemory(&pi, sizeof(pi));

    TCHAR commandLine[] = TEXT("C:\\Windows\\System32\\notepad.exe");

    std::cout << "Sprobuie zapustyty proces: " << commandLine << std::endl;

    if (!CreateProcess(
        NULL,           // Ім'я модуля (NULL означає використання командного рядка)
        commandLine,    // Командний рядок
        NULL,           // Атрибути безпеки процесу
        NULL,           // Атрибути безпеки потоку
        FALSE,          // Чи успадковуються дескриптори
        0,              // Прапорці створення
        NULL,           // Блок середовища
        NULL,           // Поточний каталог
        &si,            // Вказівник на STARTUPINFO
        &pi)            // Вказівник на PROCESS_INFORMATION
    ) {
        std::cerr << "CreateProcess failed (" << GetLastError() << ")." << std::endl;
        return 1;
    }

    std::cout << "Proces zapuscheno! PID: " << pi.dwProcessId << std::endl;

    std::cout << "Ochikuvannia zavershennia procesu..." << std::endl;
    WaitForSingleObject(pi.hProcess, INFINITE);

    DWORD exitCode;
    if (GetExitCodeProcess(pi.hProcess, &exitCode)) {
        std::cout << "Proces zaversheno z kodom: " << exitCode << std::endl;
    } else {
        std::cerr << "Nemožlyvo otrymaty exit code." << std::endl;
    }

    CloseHandle(pi.hProcess);
    CloseHandle(pi.hThread);

    return 0;
}
